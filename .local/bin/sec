#! /bin/bash
function error() {
    echo "usage: $0 < encrypt FOLDER | decrypt FILE >"
    exit 1
}

[ "$#" -ne 2 ] && error

case "$1" in
    e|encrypt)
	# Tar and encrypt
	[ ! -d "$2" ] && error
	tar -cf - "$2" | gpg --encrypt --default-recipient-self -o "$(basename "$2").tar.gpg"
	# Recursively shred folder and delete
	find "$2" -type f -exec shred {} \;
	rm -r "$2"
	;;
    d|decrypt)
	[ ! -f "$2" ] && error
	gpg --decrypt "$2" | tar -xf -
	# Delete file
	rm "$2"
	;;
    *) error ;;
esac
